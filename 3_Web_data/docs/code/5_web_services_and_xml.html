<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Programming for everybody session 3 - 5&nbsp; Web services and XML</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../code/6_JSON_and_REST.html" rel="next">
<link href="../code/4_surf_the_web.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Web services and XML</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Programming for everybody session 3</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Using Python to Access Web Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/2_reg_expressions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Regular expressions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/3_networks_and_sockets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Networks and sockets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/4_surf_the_web.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Programs that surf the web</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/5_web_services_and_xml.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Web services and XML</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../code/6_JSON_and_REST.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">JSON and REST</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-on-the-web" id="toc-data-on-the-web" class="nav-link active" data-scroll-target="#data-on-the-web"><span class="toc-section-number">5.1</span>  Data on the web</a></li>
  <li><a href="#extensible-markup-language-xml" id="toc-extensible-markup-language-xml" class="nav-link" data-scroll-target="#extensible-markup-language-xml"><span class="toc-section-number">5.2</span>  eXtensible Markup Language (XML)</a>
  <ul class="collapse">
  <li><a href="#xml-terminology" id="toc-xml-terminology" class="nav-link" data-scroll-target="#xml-terminology"><span class="toc-section-number">5.2.1</span>  XML terminology</a></li>
  <li><a href="#the-xml-tree-structure" id="toc-the-xml-tree-structure" class="nav-link" data-scroll-target="#the-xml-tree-structure"><span class="toc-section-number">5.2.2</span>  The XML tree structure</a></li>
  <li><a href="#xml-basics" id="toc-xml-basics" class="nav-link" data-scroll-target="#xml-basics"><span class="toc-section-number">5.2.3</span>  XML basics</a></li>
  <li><a href="#white-space" id="toc-white-space" class="nav-link" data-scroll-target="#white-space"><span class="toc-section-number">5.2.4</span>  White space</a></li>
  <li><a href="#xml-schema" id="toc-xml-schema" class="nav-link" data-scroll-target="#xml-schema"><span class="toc-section-number">5.2.5</span>  XML schema</a></li>
  <li><a href="#many-xml-schema-languages" id="toc-many-xml-schema-languages" class="nav-link" data-scroll-target="#many-xml-schema-languages"><span class="toc-section-number">5.2.6</span>  Many XML schema languages</a></li>
  <li><a href="#iso-8601-datetime-format" id="toc-iso-8601-datetime-format" class="nav-link" data-scroll-target="#iso-8601-datetime-format"><span class="toc-section-number">5.2.7</span>  ISO 8601 Date/Time format</a></li>
  </ul></li>
  <li><a href="#parsing-xml-in-python" id="toc-parsing-xml-in-python" class="nav-link" data-scroll-target="#parsing-xml-in-python"><span class="toc-section-number">5.3</span>  Parsing XML in python</a></li>
  <li><a href="#extracting-data-from-xml" id="toc-extracting-data-from-xml" class="nav-link" data-scroll-target="#extracting-data-from-xml"><span class="toc-section-number">5.4</span>  Extracting Data from XML</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Web services and XML</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="data-on-the-web" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="data-on-the-web"><span class="header-section-number">5.1</span> Data on the web</h2>
<ul>
<li>With the HTTP request/response well understood and supported, there was a natural move towards exchanging data between programs and these protocols</li>
<li>We needed to come up with up with an agreed way to represent data going between applications and across networks</li>
<li>Two commonly used formats are XML and JSON</li>
</ul>
</section>
<section id="extensible-markup-language-xml" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="extensible-markup-language-xml"><span class="header-section-number">5.2</span> eXtensible Markup Language (XML)</h2>
<ul>
<li>Primary purpose is to help information systems share structured data</li>
<li>It started as a simplified subset of the Standard Generalized Markup Language (SGML) and is designed to relatively human-legible</li>
<li>Consists of XML elements (or nodes) that have start and end tags in between smaller greater signs, i.e.&nbsp;<people></people></li>
<li>Contains simple and complex elements</li>
</ul>
<section id="xml-terminology" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="xml-terminology"><span class="header-section-number">5.2.1</span> XML terminology</h3>
<ul>
<li><strong>Tags</strong> indicate the beginning and the ending of elements</li>
<li><strong>Attributes</strong> are keyword/value pairs on the opening tag of XML</li>
<li><strong>Serialize and De-serialize</strong> convert data in one program into a common format that can be stored and/or transmitted between systems in a programming language-independent manner</li>
</ul>
</section>
<section id="the-xml-tree-structure" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="the-xml-tree-structure"><span class="header-section-number">5.2.2</span> The XML tree structure</h3>
<ul>
<li>XML documents form a tree structure that starts at “the root” and branches to “the leaves”.</li>
<li>XML documents are formed as element trees.</li>
<li>An XML tree starts at a root element and branches from the root to child elements.</li>
<li>All elements can have sub elements (child elements):</li>
</ul>
<pre><code>&lt;root&gt;
  &lt;child&gt;
    &lt;subchild&gt;.....&lt;/subchild&gt;
  &lt;/child&gt;
&lt;/root&gt;</code></pre>
<ul>
<li>The terms parent, child, and sibling are used to describe the relationships between elements.</li>
<li>Parents have children. Children have parents. Siblings are children on the same level (brothers and sisters).</li>
</ul>
<p><img width="500" src="../images/xml_tree.png"></p>
</section>
<section id="xml-basics" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="xml-basics"><span class="header-section-number">5.2.3</span> XML basics</h3>
<ul>
<li>The difference to HTML is that we can create our own tags</li>
<li>Start Tag, i.e.&nbsp;<name></name></li>
<li>End tag, i.e.&nbsp;</li>
<li>Text content, i.e.&nbsp;Chuck</li>
</ul>
<p>Together we can make a simple element like this:</p>
<pre><code>&lt;name&gt;Chuck&lt;/name&gt;</code></pre>
<ul>
<li>Attribute, i.e.&nbsp;type “intl”</li>
</ul>
<pre><code>&lt;phone type="intl"&gt;
+1 734 303 4456
&lt;/phone&gt;</code></pre>
<ul>
<li>Self closing tag incl.&nbsp;an attribute i.e.&nbsp;<code>&lt;email hide="yes" /&gt;</code></li>
</ul>
</section>
<section id="white-space" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="white-space"><span class="header-section-number">5.2.4</span> White space</h3>
<p>Line ends don’t really matter in XML,<br>
White space is generally discarded on text elements.<br>
We indent only to be readable.</p>
</section>
<section id="xml-schema" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="xml-schema"><span class="header-section-number">5.2.5</span> XML schema</h3>
<ul>
<li>Describing a “contract” as to what is acceptable in XML</li>
<li>Description of the legal format of an XML document</li>
<li>Expressed in terms of constraints on the structure and content of documents</li>
<li>Often used to specify a “contract” between systems: I.e. my system will only accept XML that confirms to this particular schema</li>
<li>If a particular piece of XML meets the specification of the schema, then it is said to <strong>validate</strong></li>
</ul>
</section>
<section id="many-xml-schema-languages" class="level3" data-number="5.2.6">
<h3 data-number="5.2.6" class="anchored" data-anchor-id="many-xml-schema-languages"><span class="header-section-number">5.2.6</span> Many XML schema languages</h3>
<ul>
<li>Document type definition (DTD)</li>
<li>Standard Generalized Markup language (ISO 8879:1986 SGML)</li>
<li>XML schema for W3C (XSD), the most likely one we encounter</li>
</ul>
</section>
<section id="iso-8601-datetime-format" class="level3" data-number="5.2.7">
<h3 data-number="5.2.7" class="anchored" data-anchor-id="iso-8601-datetime-format"><span class="header-section-number">5.2.7</span> ISO 8601 Date/Time format</h3>
<pre><code>2002-05-30T09:30:10Z</code></pre>
<p>Above we have:</p>
<ul>
<li>Year-month-date</li>
<li>Time of the day</li>
<li>Time zone (i.e.T…Z), which typically is specified in UTC/GMT rather than a local time zone</li>
</ul>
</section>
</section>
<section id="parsing-xml-in-python" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="parsing-xml-in-python"><span class="header-section-number">5.3</span> Parsing XML in python</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Use ET as an alias so we don't have to write the whole thing</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create some xml</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#tripple quoted string = multiline string in python</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="st">'''&lt;person&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;name&gt;Chuck&lt;/name&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;phone type="intl"&gt;+1 734 303 4456&lt;/phone&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;email hide="yes"/&gt;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/person&gt;'''</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#take the string data and give us back a nice tree</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#this would fail if you have syntax errors</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> ET.fromstring(data)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#within that xml data find some tags, i.e. name,</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">#and extract the text</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Name:'</span>, tree.find(<span class="st">'name'</span>).text)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#within that xml data find some tags, i.e. email</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#and get the attribute hide using the get method</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Attr:'</span>, tree.find(<span class="st">'email'</span>).get(<span class="st">'hide'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: Chuck
Attr: yes</code></pre>
</div>
</div>
<p>This works a bit differently if we have multiple child tags, i.e.&nbsp;below we want to extract information for each of these user tags:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">input</span> <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;stuff&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;users&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;user x="2"&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;id&gt;001&lt;/id&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;name&gt;Chuck&lt;/name&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/user&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;user x="7"&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;id&gt;009&lt;/id&gt;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="st">      &lt;name&gt;Brent&lt;/name&gt;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/user&gt;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/users&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/stuff&gt;'''</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#get tree</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>stuff <span class="op">=</span> ET.fromstring(<span class="bu">input</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#search for all of the user tags below users</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#this gives us a list of tags (i.e. a list of subtrees)</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> stuff.findall(<span class="st">'users/user'</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'User count:'</span>, <span class="bu">len</span>(lst))</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">''</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#loop through the list to get the info we want</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#i.e. find the tag name and get the child text</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> lst:</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Name:'</span>, item.find(<span class="st">'name'</span>).text)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'ID:'</span>, item.find(<span class="st">'id'</span>).text)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Attribute:'</span>, item.get(<span class="st">'x'</span>))</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>User count: 2

Name: Chuck
ID: 001
Attribute: 2
Name: Brent
ID: 009
Attribute: 7
</code></pre>
</div>
</div>
</section>
<section id="extracting-data-from-xml" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="extracting-data-from-xml"><span class="header-section-number">5.4</span> Extracting Data from XML</h2>
<p>In this assignment you will write a Python program somewhat similar to https://py4e.com/code3/geoxml.py.</p>
<p>The program will prompt for a URL, read the XML data from that URL using urllib and then parse and extract the comment counts from the XML data, compute the sum of the numbers in the file and enter the sum.</p>
<p>We provide two files for this assignment. One is a sample file where we give you the sum for your testing and the other is the actual data you need to process for the assignment.</p>
<ul>
<li>Sample data: http://py4e-data.dr-chuck.net/comments_42.xml (Sum=2553)</li>
<li>Actual data: http://py4e-data.dr-chuck.net/comments_1701461.xml (Sum ends with 75)</li>
</ul>
<p>You do not need to save these files to your folder since your program will read the data directly from the URL.</p>
<p>The data consists of a number of names and comment counts in XML as follows:</p>
<pre><code>&lt;comment&gt;
  &lt;name&gt;Matthias&lt;/name&gt;
  &lt;count&gt;97&lt;/count&gt;
&lt;/comment&gt;</code></pre>
<p>You are to look through all the <comment> tags and find the <count> values sum the numbers.</count></comment></p>
<p>To make the code a little simpler, you can use an XPath selector string to look through the entire tree of XML for any tag named ‘count’ with the following line of code:</p>
<pre><code>counts = tree.findall('.//count')</code></pre>
<p>Code can be found in <code>code/extract_xml.py</code></p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request, urllib.parse, urllib.error</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ssl</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ignore SSL certificate errors</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>ctx <span class="op">=</span> ssl.create_default_context()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>ctx.check_hostname <span class="op">=</span> <span class="va">False</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>ctx.verify_mode <span class="op">=</span> ssl.CERT_NONE</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#read in data</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'http://py4e-data.dr-chuck.net/comments_1701461.xml'</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="bu">input</span> <span class="op">=</span> urllib.request.urlopen(url, context<span class="op">=</span>ctx)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="bu">input</span>.read()</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>stuff <span class="op">=</span> ET.fromstring(data)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#find comments</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>lst <span class="op">=</span> stuff.findall(<span class="st">'comments/comment'</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#print('Comment count:', len(lst))</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#extract numbers:</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>num_list <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> lst:</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    num <span class="op">=</span> <span class="bu">int</span>(item.find(<span class="st">'count'</span>).text)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    num_list.append(num)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Sum:'</span>, <span class="bu">sum</span>(num_list))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sum: 2375</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../code/4_surf_the_web.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Programs that surf the web</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../code/6_JSON_and_REST.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">JSON and REST</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>